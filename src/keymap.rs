use core::ops::BitOr;

use embassy_time::Duration;
use rmk::action::{Action, KeyAction};
use rmk::combo::Combo;
use rmk::config::{CombosConfig, ForksConfig};
use rmk::fork::{Fork, StateBits};
use rmk::heapless::Vec;

use rmk::hid_state::{HidModifiers, HidMouseButtons};
use rmk::keycode::{KeyCode, ModifierCombination};
use rmk::light::LedIndicator;
// use rmk::{a, k, layer, mo};
use rmk::{a, k, layer, mt, osm, shifted, wm};
pub(crate) const COL: usize = 10;
pub(crate) const ROW: usize = 4;
pub(crate) const NUM_LAYER: usize = 6;

/// key shortcuts
macro_rules! K {
    ("â£") => {
        lt(NUM, KeyCode::Backspace)
    };
    (",") => {
        k!(Comma)
    };
    ("'") => {
        k!(Quote)
    };
    (".") => {
        k!(Dot)
    };
    ("R|lâ‡§") => {
        mt!(R, LSFT)
    };
    ("S|lâŒƒ") => {
        mt!(S, LCTL)
    };
    ("N|lâ‡") => {
        mt!(N, LOPT)
    };
    ("T|lâŒ˜") => {
        mt!(T, LCMD)
    };
    ("B|lâ‡§") => {
        mt!(B, LSFT)
    };
    (".|râ‡§") => {
        mt!(Dot, RSFT)
    };
    ("A|râŒ˜") => {
        mt!(A, RCMD)
    };
    ("E|râ‡") => {
        mt!(E, ROPT)
    };
    ("I|râŒƒ") => {
        mt!(I, RCTL)
    };
    ("H|râ‡§") => {
        mt!(H, RSFT)
    };
    ("/") => {
        k!(Slash)
    };
    ("-") => {
        k!(Minus)
    };
    ("â–¼") => {
        a!(Transparent)
    };
    ("âŒ«") => {
        k!(Backspace)
    };
    ("WâŒ«") => {
        wm!(Backspace, ROPT)
    };
    ("âŒ«|ğŸ…›NUM") => {
        lt(Num, KeyCode::Backspace)
    };
    ("ğŸ”|ğŸ…›SYM") => {
        lt(SYM, KeyCode::Again)
    };
    ("â£|ğŸ…›â‡‰") => {
        lt(CRD, KeyCode::Space)
    };
    ("â|ğŸ…›âŒ˜") => {
        lt(CMD, KeyCode::Enter)
    };
    ("*") => {
        k!(KpAsterisk)
    };
    ("*|/") => {
        k!(KpAsterisk)
    };
    ("!") => {
        shifted!(Kc1)
    };
    ("K|râ‡") => {
        wm!(K, ROPT)
    };
    ("W|râ‡") => {
        wm!(W, ROPT)
    };
    ("9") => {
        k!(Kc9)
    };
    ("8") => {
        k!(Kc8)
    };
    ("7") => {
        k!(Kc7)
    };
    ("6") => {
        k!(Kc6)
    };
    ("5") => {
        k!(Kc5)
    };
    ("4") => {
        k!(Kc4)
    };
    ("Â°") => {
        wm!(Kc8, ROPT.bitor(RSFT))
    };
    ("âˆ‘") => {
        wm!(W, ROPT)
    };
    ("+|-") => {
        mt!(KpPlus, LSFT)
    };
    ("3|lâŒƒ") => {
        mt!(Kc3, LCTL)
    };
    ("2|lâ‡") => {
        mt!(Kc2, LOPT)
    };
    ("1|lâŒ˜") => {
        mt!(Kc1, LCMD)
    };
    ("0|lâ‡§") => {
        mt!(Kc0, LSFT)
    };
    (".|râ‡§") => {
        mt!(Dot, RSFT)
    };
    ("A|râŒ˜") => {
        mt!(A, RCMD)
    };
    ("E|râ‡") => {
        mt!(E, ROPT)
    };
    ("I|râŒƒ") => {
        mt!(I, RCTL)
    };
    ("H|râ‡§") => {
        mt!(H, RSFT)
    };
    ("Â§") => {
        wm!(Kc6, ROPT)
    };
    ("%") => {
        shifted!(Kc5)
    };
    ("â‰¤") => {
        wm!(Comma, ROPT)
    };
    ("â‰¥") => {
        wm!(Dot, ROPT)
    };
    ("#") => {
        shifted!(Kc3)
    };
    ("=|^") => {
        k!(KpEqual)
    };
    ("_") => {
        shifted!(Minus)
    };
    ("Âµ") => {
        wm!(M, ROPT)
    };
    ("Â±") => {
        wm!(Equal, ROPT.bitor(RSFT))
    };
    ("â‰ˆ") => {
        wm!(X, ROPT)
    };
    ("â‰ ") => {
        wm!(Equal, ROPT)
    };
    ("â†") => {
        k!(Left)
    };
    ("â†‘") => {
        k!(Up)
    };
    ("â†“") => {
        k!(Down)
    };
    ("â†’") => {
        k!(Right)
    };
    ("^") => {
        wm!(I, LOPT)
    };
    ("`") => {
        k!(GraveEscape)
    };
    ("?") => {
        shifted!(Minus)
    };
    ("{|}") => {
        shifted!(LeftBracket)
    };
    ("[|]") => {
        k!(LeftBracket)
    };
    ("(|)") => {
        shifted!(Kc9)
    };
    ("<|>") => {
        shifted!(Comma)
    };
    ("FâŒ«") => {
        wm!(D, LCTL)
    };
    ("!") => {
        shifted!(Kc1)
    };
    ("@") => {
        shifted!(Kc2)
    };
    ("=") => {
        k!(Equal)
    };
    ("&") => {
        shifted!(Kc7)
    };
    ("#") => {
        shifted!(Kc3)
    };
    ("~") => {
        wm!(N, LOPT)
    };
    ("$") => {
        shifted!(Kc4)
    };
    ("âˆ–") => {
        k!(Backslash)
    };
    ("-") => {
        k!(Minus)
    };
    ("â‚¬") => {
        wm!(Kc2, RSFT.bitor(ROPT))
    };
    // find all
    ("ğŸ”âˆ—") => {
        wm!(F, LCMD.bitor(LSFT))
    };
    // find
    ("ğŸ”") => {
        wm!(F, LSFT)
    };
    // redo
    ("â†·") => {
        wm!(Z, LCMD.bitor(LSFT))
    };
    // undo
    ("â†¶") => {
        wm!(Z, LCMD)
    };
    // switch App
    ("â‡¨â§‰") => {
        wm!(Tab, LCMD)
    };
    ("ğŸ”‰") => {
        k!(KbVolumeDown)
    };
    ("ğŸ”‡") => {
        k!(KbMute)
    };
    ("ğŸ”Š") => {
        k!(KbVolumeUp)
    };
    ("ğŸ”…") => {
        k!(BrightnessDown)
    };
    ("ğŸ”†") => {
        k!(BrightnessUp)
    };
    //â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
    // SelectAll  cut  copy  paste pasteHist <-space <-win  winMid  win->  space->
    // select all
    ("âœ”*") => {
        wm!(A, LCMD)
    };
    ("âœ‚") => {
        wm!(X, LCMD)
    };
    ("â§‰") => {
        wm!(C, LCMD)
    };
    ("ğŸ“‹") => {
        wm!(V, LCMD)
    };
    ("ğŸ“‹*") => {
        wm!(V, LCMD.bitor(LSFT))
    };
    // Switch to left desktop
    ("ğŸ–¥ï¸â¬…") => {
        wm!(Left, RCTL)
    };
    // place window left
    ("â¬…â–¢") => {
        wm!(Left, RCTL.bitor(ROPT).bitor(RSFT))
    };
    // place window right
    ("â–¢ğŸ¡º") => {
        wm!(Right, RCTL.bitor(ROPT).bitor(RSFT))
    };
    ("ğŸ¡ºğŸ–¥ï¸") => {
        wm!(Right, RCTL)
    };
    // findPrev
    ("â‡¤ğŸ”") => {
        wm!(Enter, LSFT)
    };
    //fNext Enter  tab   switchWin   ESC   prev  play/pause next
    ("ğŸ”â‡¥") => {
        wm!(N, LSFT)
    };
    ("â†©") => {
        k!(Enter)
    };
    ("â‡¥") => {
        k!(Tab)
    };
    // switch windows
    ("â‡¨â–¢") => {
        wm!(Grave, LCMD)
    };
    ("â‹") => {
        k!(Escape)
    };
    ("â®") => {
        k!(MediaPrevTrack)
    };
    ("â¯") => {
        k!(MediaPlayPause)
    };
    ("â­") => {
        k!(MediaNextTrack)
    };
    // forward delete
    // TODO implement fn key!
    // ("âŒ¦") => {
    //   wm!(Backspace, _fn_)
    // };
    //
    // Catch-all case to trigger compile-time error if the string doesn't match
    ($key:expr) => {
        compile_error!(concat!("Unmatched key: ", $key))
    };
}

const XX: KeyAction = a!(No);
const __: KeyAction = a!(Transparent);

#[rustfmt::skip]
pub fn get_default_keymap() -> [[[KeyAction; COL]; ROW]; NUM_LAYER] {
  [
  // Alpha (base) Layer
    /*  Based on: 34 Keys - Hands Down neu
    https://sites.google.com/alanreiser.com/handsdown/home/hands-down-neu?authuser=0
    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
    â”‚ w  f  m  p  v â”‚ â”‚ /  .  q  "  '  zâ”‚
    â”‚ r  s  n  t  b â”‚ â”‚ ,  a  e  i  h  jâ”‚
    â”‚ x  c  l  d  g â”‚ â”‚ -  u  o  y  k   â”‚     
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®,; .:â”‚ â”‚ â£  ââ•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
              â•°â”€â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â”€â•¯         
  === Variante Pat ===
    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
    â”‚ w  f  m  p  v  â”‚ â”‚ '  .  g  j  z â”‚
    â”‚ r  s  n  t  b  â”‚ â”‚ ,  a  e  i  h â”‚
    â”‚ x  c  l  d  /  â”‚ â”‚ -  u  o  y  k â”‚
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â•® âŒ« REP â”‚ â”‚ â£  â   â•­â”€â”€â”€â”€â”€â”€â•¯
             â•°â”€â”€â”€â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â”€â”€â”€â”€â•¯         
    // â•°â”€â”€â”€â”€â”€â”€â”€â”€â•® âŒ«W REPâ”‚ â”‚ â£  â   â•­â”€â”€â”€â”€â”€â”€â•¯
    // âŒ«W only possible with Macros (for lt! to work ([osm!(Lctl), k!(Backspace)])) 
  hold (HRM)
    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
    â”‚  -  -  -  -  -   â”‚ â”‚ -  -  -  -  -  â”‚
    â”‚  â‡§  âŒƒ  âŒ¥  âŒ˜  â‡§   â”‚ â”‚ â‡§  âŒ˜  âŒ¥  âŒƒ  â‡§  â”‚
    â”‚  -  -  -  -  -   â”‚ â”‚ -  -  -  -  -  â”‚
    â•°â”€â”€â”€â”€â”€â”€â•® NUM  SYM  â”‚ â”‚ CRD CMD â•­â”€â”€â”€â”€â”€â”€â•¯
           â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯         
    (The innermost shift is a layer toggle, this shall be used for shifting the keys (so we get alternative shifted symbols). 
    Because this isn't combinable with the HRM, the outermost shift is a normal shift key for combinations with othr modifier keys.)

   Chorded Letters
    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
    â”‚ Qu           â”‚ â”‚                 â”‚
    â”‚ / \          â”‚ â”‚                 â”‚
    â”‚ W  F  _  _  _â”‚ â”‚_  _     _  _  _ â”‚
    â”‚ _  ÃŸ -_--_--_â”‚ â”‚_- E -Ã„- A  _  _ â”‚
    â”‚              â”‚ â”‚   â”‚ \           â”‚
    â”‚              â”‚ â”‚   Ãœ  Ã–          â”‚
    â”‚              â”‚ â”‚   â”‚    \        â”‚
    â”‚ _  _  _  _  _â”‚ â”‚_  U     O  _  _ â”‚
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â•® WâŒ« _â”‚ â”‚_  _ â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
             â•°â”€â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â”€â•¯
  */   
  layer!([// Alpha (Base)
    // TODO
    // - hold (layer switch)
    //   - tri-layers
    //   - mo_NUM + mo_SYM = mo CMD
    //   - mo_CHORD + mo_CMD = mo FUN
    //    - wrd_bsp+space = Backspace
    //    - left outer thumb + right outer thumb = shift in CMD layer
    // - combos -> need macros
    //   - W+F = Qu
    //   - S+E = ÃŸ
    //    - A+E = Ã„
    //    - U+E = Ãœ
    //    - O+E = Ã–
    //    - S+H = sch
    //  == need RMK extension: 
    // - CHORDS -> need macros
    //  - CapsW for Chord using Bsp key
    // - Repeat Function
    // - HRM => `fn`-key (doesn't exist) (called 'globe' key, need to set vendor ID to apple)
    //â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
      [ k!(W),     k!(F),      k!(M),       k!(P),      k!(V),          K!("'"),     K!(","),    k!(G),      k!(J),      k!(Z)     ],
    //â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      [K!("R|lâ‡§"), K!("S|lâŒƒ"), K!("N|lâ‡"), K!("T|lâŒ˜"), K!("B|lâ‡§"),     K!(".|râ‡§"),  K!("A|râŒ˜"), K!("E|râ‡"), K!("I|râŒƒ"), K!("H|râ‡§")],
    //â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      [ k!(X),     k!(C),      k!(L),       k!(D),      K!("/"),        K!("-"),     k!(U),      k!(O),      k!(Y),      k!(K)     ],            
    //â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                          â”‚â”‚                         â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
      [ XX,        XX,         XX,          K!("â£"),    K!("ğŸ”|ğŸ…›SYM"),  K!("â£|ğŸ…›â‡‰"), K!("â|ğŸ…›âŒ˜"), XX,        XX,         XX        ]
    //                                    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
  ]),
  layer!([// NUM
    // TODO thumb keys
    // TODO HRM right side -> doesn't work with shifted keys! Macros?
    // TODO change to unicode symmbols once Macros are working
    //â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®â•­â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
      [K!("*|/"), K!("9"),    K!("8"),     K!("7"),    K!(","),     K!("'"), K!("!"), __,      K!("Â°"), K!("âˆ‘")],
    //â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      [K!("+|-"), K!("3|lâŒƒ"), K!("2|lâ‡"), K!("1|lâŒ˜"), K!("0|lâ‡§"),  K!("Â§"), K!("%"), K!("â‰¤"), K!("â‰¥"), K!("#")],
    //â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      [K!("=|^"), K!("6"),    K!("5"),     K!("4"),    K!("."),     K!("_"), K!("Âµ"), K!("Â±"), K!("â‰ˆ"), K!("â‰ ")],
    //â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                       â”‚â”‚                 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
      [__,        __,         __,           __,        __,          __,      __,      __,      __,      __     ]
    //                                   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯â•°â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â•¯
  ]),
  layer!([//SYM
    // TODO HRM
    //â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®â•­â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
      [ K!("â†"),  K!("â†‘"),   K!("â†“"),   K!("â†’"),   K!("^"),  K!("`"), K!("?"), K!("â–¼"), K!("â–¼"), K!("â–¼")],
    //â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      [K!("{|}"), K!("[|]"), K!("(|)"), K!("<|>"), K!("FâŒ«"), K!("!"), K!("@"), K!("="), K!("&"), K!("#")],
    //â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      [__,        __,        K!("~"),   K!("$"),   K!("âˆ–"),  K!("-"), K!("â‚¬"), __,      __,      __      ],
    //â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                    â”‚â”‚                â•­â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
      [__,        __,        __,        K!("WâŒ«"),  __,       __,      __,      __,      __,      __     ]
    //                                 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯â•°â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â•¯
  ]),
  layer!([//CMD
    // TODO think of Window mid
    // HRM with OSM on CRD layer?
    //â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
      [K!("ğŸ”âˆ—"), K!("ğŸ”"),  K!("â†·"), K!("â†¶"),  K!("â‡¨â§‰"),  K!("ğŸ”‰"),  K!("ğŸ”‡"),  K!("ğŸ”Š"), K!("ğŸ”…"),  K!("ğŸ”†")], 
    //â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      [K!("âœ”*"), K!("âœ‚"),    K!("â§‰"), K!("ğŸ“‹"), K!("ğŸ“‹*"), K!("ğŸ–¥ï¸â¬…"), K!("â¬…â–¢"), __,       K!("â–¢ğŸ¡º"), K!("ğŸ¡ºğŸ–¥ï¸")],
    //â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      [K!("â‡¤ğŸ”"), K!("ğŸ”â‡¥"), K!("â†©"), K!("â‡¥"),  K!("â‡¨â–¢"),   K!("â‹"),   K!("â®"),  K!("â¯"),  K!("â­"),  __],   
    //â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â•®                    â”‚â”‚                     â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
      [__, __, __, __, __, __, __, __, __, __]
    //                              â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
    ]),
  layer!([//CRD
    //â•­â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â•®â•­â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â•®
    [k!(C), __, __, __, __, __, __, __, __, __],
    //â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
    [osm!(LSFT), osm!(LCTL), osm!(LOPT), osm!(LCMD), osm!(LSFT), osm!(RSFT), osm!(RCMD), osm!(ROPT), osm!(RCTL), osm!(RSFT)],
    //â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
    [__, __, __, __, __, __, __, __, __, __],
    //â•°â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                         â”‚â”‚                             â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â•¯
    [__, __, __, __, __, __, __, __, __, __]
    //                                 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
  ]),
  layer!([//layer for VIAL modifications
    [__, __, __, __, __, __, __, __, __, __],
    [__, __, __, __, __, __, __, __, __, __],
    [__, __, __, __, __, __, __, __, __, __],
    [__, __, __, __, __, __, __, __, __, __]
  ]),
  ]
}

/// combos
pub(crate) fn get_combos() -> CombosConfig {
    CombosConfig {
        combos: Vec::from_slice(&[
            Combo::new([k!(W), k!(F)], k!(Q), Some(ALPHA)),
            // CapsW
            Combo::new([mt!(B, LSFT), mt!(Dot, RSFT)], osm!(LSFT), None),
        ])
        .expect("Some combo is not valid"),
        timeout: Duration::from_millis(50),
    }
}
/// forks
pub(crate) fn get_forks() -> ForksConfig {
    ForksConfig {
        forks: Vec::from_slice(&[
            // . -> :
            fork_alternative_shift(mt!(Dot, RSFT), shifted!(Semicolon)),
            // , -> ,
            fork_alternative_shift(k!(Comma), k!(Semicolon)),
            // / -> |
            fork_alternative_shift(k!(Slash), shifted!(Backslash)),
            // * -> /
            fork_alternative_shift(k!(KpAsterisk), k!(KpSlash)),
            // + -> -
            fork_alternative_shift(mt!(KpPlus, LSFT), k!(KpMinus)),
            // = -> ^
            fork_alternative_shift(k!(KpEqual), wm!(I, LOPT)),
            // { -> }
            fork_alternative_shift(shifted!(LeftBracket), shifted!(RightBracket)),
            // ( -> )
            fork_alternative_shift(shifted!(Kc9), shifted!(Kc0)),
            // < -> >
            fork_alternative_shift(shifted!(Comma), shifted!(Dot)),
        ])
        .expect("Some fork is not valid"),
    }
}

/// modifiers
const LCMD: ModifierCombination = ModifierCombination::new_from(false, true, false, false, false);
const LOPT: ModifierCombination = ModifierCombination::new_from(false, false, true, false, false);
const LSFT: ModifierCombination = ModifierCombination::new_from(false, false, false, true, false);
const LCTL: ModifierCombination = ModifierCombination::new_from(false, false, false, false, true);
const RCMD: ModifierCombination = ModifierCombination::new_from(true, true, false, false, false);
const ROPT: ModifierCombination = ModifierCombination::new_from(true, false, true, false, false);
const RSFT: ModifierCombination = ModifierCombination::new_from(true, false, false, true, false);
const RCTL: ModifierCombination = ModifierCombination::new_from(true, false, false, false, true);

/// lt! but using layer names
const fn lt(layer: u8, key: KeyCode) -> KeyAction {
    KeyAction::LayerTapHold(Action::Key(key), layer)
}

/// layer names
const ALPHA: u8 = 0;
const NUM: u8 = 1;
const SYM: u8 = 2;
const CMD: u8 = 3;
const CRD: u8 = 4;

fn fork_alternative_shift(trigger: KeyAction, alternative: KeyAction) -> Fork {
    Fork::new(
        trigger,
        trigger,
        alternative,
        StateBits::new_from(
            HidModifiers::new_from(false, true, false, false, false, false, false, false),
            LedIndicator::default(),
            HidMouseButtons::default(),
        ),
        StateBits::default(),
        HidModifiers::default(),
        false,
    )
}
